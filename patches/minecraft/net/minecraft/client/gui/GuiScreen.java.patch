--- before/net/minecraft/client/gui/GuiScreen.java
+++ after/net/minecraft/client/gui/GuiScreen.java
@@ -3,25 +3,8 @@
 import com.google.common.base.Splitter;
 import com.google.common.collect.Lists;
 import com.google.common.collect.Sets;
-import java.awt.Toolkit;
-import java.awt.datatransfer.ClipboardOwner;
-import java.awt.datatransfer.DataFlavor;
-import java.awt.datatransfer.StringSelection;
-import java.awt.datatransfer.Transferable;
-import java.io.File;
-import java.io.IOException;
-import java.net.URI;
-import java.net.URISyntaxException;
-import java.util.Arrays;
-import java.util.List;
-import java.util.Locale;
-import java.util.Set;
 import net.minecraft.client.Minecraft;
-import net.minecraft.client.renderer.BufferBuilder;
-import net.minecraft.client.renderer.GlStateManager;
-import net.minecraft.client.renderer.RenderHelper;
-import net.minecraft.client.renderer.RenderItem;
-import net.minecraft.client.renderer.Tessellator;
+import net.minecraft.client.renderer.*;
 import net.minecraft.client.renderer.vertex.DefaultVertexFormats;
 import net.minecraft.client.util.ITooltipFlag;
 import net.minecraft.item.ItemStack;
@@ -38,8 +21,22 @@
 import org.apache.commons.lang3.StringUtils;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
-import org.lwjgl.input.Keyboard;
-import org.lwjgl.input.Mouse;
+import org.lwjglx.input.Keyboard;
+import org.lwjglx.input.Mouse;
+
+import java.awt.*;
+import java.awt.datatransfer.ClipboardOwner;
+import java.awt.datatransfer.DataFlavor;
+import java.awt.datatransfer.StringSelection;
+import java.awt.datatransfer.Transferable;
+import java.io.File;
+import java.io.IOException;
+import java.net.URI;
+import java.net.URISyntaxException;
+import java.util.Arrays;
+import java.util.List;
+import java.util.Locale;
+import java.util.Set;
 
 @SideOnly(Side.CLIENT)
 public abstract class GuiScreen extends Gui implements GuiYesNoCallback
@@ -61,25 +58,24 @@
     private int field_146298_h;
     private URI field_175286_t;
     private boolean field_193977_u;
+    protected boolean keyHandled, mouseHandled; // Forge: allow canceling key and mouse Post events from handleMouseInput and handleKeyboardInput
 
     public void func_73863_a(int p_73863_1_, int p_73863_2_, float p_73863_3_)
     {
-        for (int i = 0; i < this.field_146292_n.size(); ++i)
-        {
-            ((GuiButton)this.field_146292_n.get(i)).func_191745_a(this.field_146297_k, p_73863_1_, p_73863_2_, p_73863_3_);
+        for (GuiButton guiButton : this.field_146292_n) {
+            guiButton.func_191745_a(this.field_146297_k, p_73863_1_, p_73863_2_, p_73863_3_);
         }
 
-        for (int j = 0; j < this.field_146293_o.size(); ++j)
-        {
-            ((GuiLabel)this.field_146293_o.get(j)).func_146159_a(this.field_146297_k, p_73863_1_, p_73863_2_);
+        for (GuiLabel guiLabel : this.field_146293_o) {
+            guiLabel.func_146159_a(this.field_146297_k, p_73863_1_, p_73863_2_);
         }
     }
-
+    public final void invokeKeyTyped(char key, int code) throws IOException {func_73869_a(key, code);}
     protected void func_73869_a(char p_73869_1_, int p_73869_2_) throws IOException
     {
         if (p_73869_2_ == 1)
         {
-            this.field_146297_k.func_147108_a((GuiScreen)null);
+            this.field_146297_k.func_147108_a(null);
 
             if (this.field_146297_k.field_71462_r == null)
             {
@@ -131,7 +127,10 @@
 
     protected void func_146285_a(ItemStack p_146285_1_, int p_146285_2_, int p_146285_3_)
     {
-        this.func_146283_a(this.func_191927_a(p_146285_1_), p_146285_2_, p_146285_3_);
+        FontRenderer font = p_146285_1_.func_77973_b().getFontRenderer(p_146285_1_);
+        net.minecraftforge.fml.client.config.GuiUtils.preItemToolTip(p_146285_1_);
+        this.drawHoveringText(this.func_191927_a(p_146285_1_), p_146285_2_, p_146285_3_, (font == null ? field_146289_q : font));
+        net.minecraftforge.fml.client.config.GuiUtils.postItemToolTip();
     }
 
     public List<String> func_191927_a(ItemStack p_191927_1_)
@@ -142,7 +141,7 @@
         {
             if (i == 0)
             {
-                list.set(i, p_191927_1_.func_77953_t().field_77937_e + (String)list.get(i));
+                list.set(i, p_191927_1_.func_77973_b().getForgeRarity(p_191927_1_).getColor() + (String)list.get(i));
             }
             else
             {
@@ -170,7 +169,13 @@
 
     public void func_146283_a(List<String> p_146283_1_, int p_146283_2_, int p_146283_3_)
     {
-        if (!p_146283_1_.isEmpty())
+        drawHoveringText(p_146283_1_, p_146283_2_, p_146283_3_, field_146289_q);
+    }
+
+    protected void drawHoveringText(List<String> p_146283_1_, int p_146283_2_, int p_146283_3_, FontRenderer font)
+    {
+        net.minecraftforge.fml.client.config.GuiUtils.drawHoveringText(p_146283_1_, p_146283_2_, p_146283_3_, field_146294_l, field_146295_m, -1, font);
+        if (false && !p_146283_1_.isEmpty())
         {
             GlStateManager.func_179101_C();
             RenderHelper.func_74518_a();
@@ -403,10 +408,13 @@
 
     public void func_175281_b(String p_175281_1_, boolean p_175281_2_)
     {
+        p_175281_1_ = net.minecraftforge.event.ForgeEventFactory.onClientSendMessage(p_175281_1_);
+        if (p_175281_1_.isEmpty()) return;
         if (p_175281_2_)
         {
             this.field_146297_k.field_71456_v.func_146158_b().func_146239_a(p_175281_1_);
         }
+        if (net.minecraftforge.client.ClientCommandHandler.instance.func_71556_a(field_146297_k.field_71439_g, p_175281_1_) != 0) return;
 
         this.field_146297_k.field_71439_g.func_71165_d(p_175281_1_);
     }
@@ -421,9 +429,15 @@
 
                 if (guibutton.func_146116_c(this.field_146297_k, p_73864_1_, p_73864_2_))
                 {
+                    net.minecraftforge.client.event.GuiScreenEvent.ActionPerformedEvent.Pre event = new net.minecraftforge.client.event.GuiScreenEvent.ActionPerformedEvent.Pre(this, guibutton, this.field_146292_n);
+                    if (net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(event))
+                        break;
+                    guibutton = event.getButton();
                     this.field_146290_a = guibutton;
                     guibutton.func_146113_a(this.field_146297_k.func_147118_V());
                     this.func_146284_a(guibutton);
+                    if (this.equals(this.field_146297_k.field_71462_r))
+                        net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.ActionPerformedEvent.Post(this, event.getButton(), this.field_146292_n));
                 }
             }
         }
@@ -453,8 +467,12 @@
         this.field_146289_q = p_146280_1_.field_71466_p;
         this.field_146294_l = p_146280_2_;
         this.field_146295_m = p_146280_3_;
+        if (!net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.InitGuiEvent.Pre(this, this.field_146292_n)))
+        {
         this.field_146292_n.clear();
         this.func_73866_w_();
+        }
+        net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.InitGuiEvent.Post(this, this.field_146292_n));
     }
 
     public void func_183500_a(int p_183500_1_, int p_183500_2_)
@@ -473,7 +491,10 @@
         {
             while (Mouse.next())
             {
+                this.mouseHandled = false;
+                if (net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.MouseInputEvent.Pre(this))) continue;
                 this.func_146274_d();
+                if (this.equals(this.field_146297_k.field_71462_r) && !this.mouseHandled) net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.MouseInputEvent.Post(this));
             }
         }
 
@@ -481,7 +502,10 @@
         {
             while (Keyboard.next())
             {
+                this.keyHandled = false;
+                if (net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.KeyboardInputEvent.Pre(this))) continue;
                 this.func_146282_l();
+                if (this.equals(this.field_146297_k.field_71462_r) && !this.keyHandled) net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.KeyboardInputEvent.Post(this));
             }
         }
     }
@@ -543,6 +567,7 @@
     public void func_146276_q_()
     {
         this.func_146270_b(0);
+        net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.client.event.GuiScreenEvent.BackgroundDrawnEvent(this));
     }
 
     public void func_146270_b(int p_146270_1_)
